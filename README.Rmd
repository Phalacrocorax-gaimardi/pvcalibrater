---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# pvcalibrater

<!-- badges: start -->
badge_codecov(ghaccount="Phalacrocorax-gaimardi",ghrepo="pvcalibrater",branch="master")
<!-- badges: end -->

pvcalibrater calibrates agent-based-model for solar photo-voltaic adoption by Irish households. 

Each agent has a utility function for pv adoption consisting of individually weighted financial, social and barrier partial (dis-)utility terms.

## Installation

You can install pvcalibrater from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("Phalacrocorax-gaimardi/pvcalibrater")
```

## Data

Survey data consists 28 features for 1208 agents. 

```{r data, echo = F}
library(pvcalibrater)
library(knitr) %>% suppressWarnings()
## survey answers
kable(pv_qanda[30:37,],row.names=F, caption ="A survey of pv_qanda describing the survey questions and choice of answers")
## the data
kable(pv_data[10:14,],row.names=F,caption = "A sample of pv_data which contains the survey responses")
##restrict to owner-occupiers excluding apartments
pv_data_oo <- pv_data %>% dplyr::filter(q1 %in% 2:4,q3 %in% 1:2)
```

## Model

A boosted tree regression model predicts the utility for pv adoption from the discrete values taken by 27 agent features.

```{r eval=F}
##xgboost
bst <- get_boosted_tree_model(pv_data_oo,complexity_factor = 1.5)
##partial utility contribution for each feature and agent
shap_scores_long_sample <- get_shap_scores(pv_data_oo,bst)
##average utilities for features used in ABM (financial q9_1, social qsp21 and barrier)
get_empirical_partial_utilities(shap_scores_long)
##individual weights for financial, social and barrier terms
abm_weights <- get_model_weights(shap_scores_long)
```


## Plot

```{r plots, echo = FALSE}
plot_weights(shap_scores_long_sample)
```
